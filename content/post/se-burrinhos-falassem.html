---
title: "E se os burrinhos falassem?"
date: 2017-12-10T02:55:18-03:00
draft: false
---
<!DOCTYPE html>
<html lang="pt-br">

  <head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script src="libraries/radar-chart-d3/src/radar-chart.js"></script>
  </head>

  <body>
    <div class="container">
      <p>
        Esses dias eu estava passando pelo Açude Velho, um ponto bastante famoso aqui em Campina Grande,
        e me deparei com algumas esculturas bem características e que são cartões postais dessa cidade.
        Eu me pus a pensar, enquanto observava as esculturas, como seria o dia a dia delas, o que elas
        viam todos os dias e qual seria a impressão da cidade, movimentação de pessoas e sua diversidade.
      </p>
      <p>
        Se os burrinhos pudessem falar, qual história eles nos contariam?
      </p>
      <p>
        Os dados foram coletados pelo pessoal do <a href="https://www.facebook.com/LabRua/">LabRua</a>
        e incluem dois pontos turísticos da cidade de Campina Grande: O
        <a href="http://s2.glbimg.com/ui3kJ5T3lugqlmGDGMIWCxt0lGU=/620x465/s.glbimg.com/jo/g1/f/original/2015/09/24/monumento150anos_campinagrande.jpg">Monumento aos 150 anos de Campina Grande (Burrinhos)</a>,
         <a href="http://www.paraibacriativa.com.br/wp-content/uploads/2015/09/pioneiros-da-borborema-1.jpg">Os pioneiros da Borborema (Jackson)</a>
         e o <a href="http://i1083.photobucket.com/albums/j400/max_mx28/DSC02372_zpsir953n3g.jpg">Bobs do Açude Velho</a>.
         Algumas coisas que fiquei imaginando foram "Qual será o horário em que eles vêem mais pessoas?" e
         "Qual desses três lugares é o mais popular/mais visitado?". Através da visualização abaixo podemos ter uma noção:
      </p>
      <div class="chart-container" id="chart-container"></div>
      <p>
        Podemos perceber de cara que dos três pontos analisados, os burrinhos vêem mais pessoas, é o mais popular
        destes. O Bobs e o Jackson vêem uma quantidade parecida de pessoas, porém o Bobs parece receber mais visitas.
      </p>
      <p>
        Os burrinhos têm seu horário de pico às 8h da manhã, seguido de picos às 7h da manhã,
        9h, 11h30min, 14h e 17h15min. A explicação para isso é que este monumento fica em um cruzamento, logo
        esses horários são comuns para quem se desloca em direção ao trabalho, escola ou universidade.
        Dessa forma, como os horários de início de atividade dessas instituições se dão comumente nestes horários,
        é comum que haja um fluxo maior de pessoas.
      </p>
      <p>
        Esse gráfico contabilizou veículos motorizados e pedestres, ou seja, considerou todas as pessoas vistas
        pelos monumentos.
      </p>
      <h2>
        Quem domina a pista? Carros ou motos?
      </h2>
      <div class="carros-motos-container" id="carros-motos-container"></div>

      <style>
        .carros-motos-container.axis path,
        .carros-motos-container.axis line {
          fill: none;
          stroke: #ddd;
          shape-rendering: crispEdges;
        }

        .carros-motos-container.x.axis path {
          //fill: #ddd;
          stroke: #ddd;
        }

        .carros-motos-container.tick {
        fill: #999;
          }

        .carros-motos-container.line {
          fill: none;
          stroke: steelblue;
          stroke-width: 1px;
        }

        .carros-motos-container.selectedline {
          fill: none;
          stroke: steelblue;
          stroke-width: 8px;
        }

         .carros-motos-container.lineSelected {

         }

        .carros-motos-containercircle {
          pointer-events: all;
          cursor: points;
        }

        .carros-motos-container.d3-tip {
          line-height: 1;
          font-weight: bold;
          padding: 12px;
          background: rgba(0, 0, 0, 0.8);
          color: #fff;
          border-radius: 2px;
        }

        /* Creates a small triangle extender for the tooltip */
        .carros-motos-container.d3-tip:after {
          box-sizing: border-box;
          display: inline;
          font-size: 10px;
          width: 100%;
          line-height: 1;
          color: rgba(0, 0, 0, 0.8);
          content: "\25BC";
          position: absolute;
          text-align: center;
        }

        /* Style northward tooltips differently */
        .carros-motos-container.d3-tip.n:after {
          margin: -1px 0 0 0;
          top: 100%;
          left: 0;
        }
      </style>

      <script>
        var margin = {top: 20, right: 80, bottom: 30, left: 50},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var parseDate = d3.time.format("%Y%m%d").parse;

        var x = d3.time.scale()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height, 0]);

        var color = d3.scale.category10();

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left");

        var line = d3.svg.line()
            .interpolate("cardinal")
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.value); });

        var tip = d3.tip()
          .attr('class', 'd3-tip')
          .offset([-10, 0])
          .html(function(d) {
            return "<strong>Frequency:</strong> <span style='color:pink'>" + d.value + "</span>";
          })

        var reorder = function(){
          // make sure the selected line is on top...
          // with D3 v3, ordering  is easiser with jquery but v4 has better ordering

          var selectedLineGroup = $(".lineSelected");
          selectedLineGroup.remove();

          // add it back first
          $('#chart').append(selectedLineGroup);
        }

        var getLineColor = function(d){
           return ( d.selected ) ? "pink" : "lightgrey";
        }

        var getLineWidth = function(d){
           return ( d.selected ) ? "4px" : "1px";
        }

        var getCityClass = function(d){
           return ( d.selected ) ? "city lineSelected" : "city";
        }

        var svg = d3.select("carros-motos-container").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("id","chart")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



        var tabProcessData = function(data){

            color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

          data.forEach(function(d) {
            d.date = parseDate(d.date);
          });

          return data;
        }

        var createCitiesData = function(data){
          return color.domain().map(function(name) {

            let bSelected = (name === "San Francisco") ? true : false;

            return {
              name: name,
              values: data.map(function(d) {
                return {date: d.date, value: +d[name], selected: bSelected};
              }),
              selected: bSelected,
            };
          });
        }

        var createChart = function(data){

          var cities = createCitiesData(data);

          x.domain(d3.extent(data, function(d) { return d.date; }));

          y.domain([
            d3.min(cities, function(c) { return d3.min(c.values, function(v) { return v.value; }); }),
            d3.max(cities, function(c) { return d3.max(c.values, function(v) { return v.value; }); })
          ]);

          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis);

          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis)
            .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .text(""); // obviously a value - label isn't necessary



          var city = svg.selectAll(".city")
              .data(cities)
            .enter().append("g")
              .attr("class", "city");

          let path = city.append("path")
              .attr("class", "line")
              .attr("d", function(d) { return line(d.values); })
              .style("stroke", function(d) { return getLineColor(d) })
              .style("stroke-width", function(d) { return getLineWidth(d) });

          var totalLength = 5;

          let onUpdate = function(){

          };

          let pathLengths = [];

          path.each( function() {
        		var len = d3.select(this).node().getTotalLength();
            pathLengths.push(len);
          });


          let getTotalLengthPerNode = function(d,i){
            let totalLength = pathLengths[i];
            return totalLength + " " + totalLength
          }

            path
              .attr("stroke-dasharray", function(d,i){return getTotalLengthPerNode()})
              .attr("stroke-dashoffset", totalLength)
              .transition()
                .duration(2000)
                .ease("linear")
            		.each("end", onUpdate)
                .attr("stroke-dashoffset", 0)


          // add the points

          var point = city.append("g")
                          .attr("class", "line-point");


          point.selectAll('circle')
          .data(function(d){ return d.values})
          .enter().append('circle')
          .on("mouseover", tip.show)
          .on("mouseout", tip.hide)
          .attr("cx", function(d) { return x(d.date) })
          .attr("cy", function(d) { return y(d.value) })
          .attr("r", 0)
          .style("opacity", function(d){ return (d.selected) ? 1 : 0})
          .style("fill", "white")
          .style("stroke", function(d) { return getLineColor(d); })
          .transition()
            .duration(1000)
            .delay( function(d,i){ return 250 + ( 750 * i) })
            .attr("r", 5);

          // city label
          cityLabelContainer = city
              .append("g")
              .attr("class", "cityLabelContainer");

          cityLabelContainer
          	.append("text")
          	.datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
              .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.value) + ")"; })
              .attr("x", 5)
              .attr("dy", ".35em")
              .text(function(d) {  return d.name; });


          reorder();

        }

        var getDummyData = function(){
          /*

          date  New York  San Francisco Austin
          20161001  432 624 724
          20161002  582 594 674
          20161003  999 599 694
          20161004  575 584 685
          20161005  200 399 360
          20161006  758 757 770
          20161007  257 526 282

        0bject
        Austin:"724"
        New York:"432"
        San Francisco:"624"
        date:"20161001"

        */


          let cityNames = ["new york","toronto","San Francisco","bangalore","tokyo"];
          let dates = ["20161001", "20161002","20161003","20161004","20161005","20161006","20161007"];

          let data = [];

          dates.forEach((dateStr) => {

            let dataObj = {
              "new york" : Math.floor( Math.random() * 1500 ),
              "toronto" : Math.floor( Math.random() * 1500 ),
              "San Francisco" : Math.floor( Math.random() * 1500 ),
              "bangalore" : Math.floor( Math.random() * 1500 ),
              "tokyo" : Math.floor( Math.random() * 1500 ),
              date: dateStr,
            }

            data.push(dataObj);

          });

        	//console.log(data)
          return data;

        }

        var onTabLoaded = function(data){

          data = tabProcessData(data);
          createChart(data);

          // make sure the selected line is on top...
          // D3 v3 isnt easiser with jquery but v4 has better ordering
          let selectedLineGroup = $(".lineSelected");
          selectedLineGroup.remove();

        	// add it back first
          $('svg g').append(selectedLineGroup);


        }


        var dummyData = getDummyData();

        onTabLoaded(dummyData);

        //d3.tsv("data.tsv", onTabLoaded);
      </script>

      <h2>
        Há uma diferença numérica entre homens e mulheres na rua?
      </h2>
      <div class="diff-chart" id="diff-chart"></div>

      <style>
        .axis path,
        .diff-chart.axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .x.axis path {
          display: none;
        }

        .area.above {
          fill: rgb(252,141,89);
        }

        .area.below {
          fill: MediumPurple;
        }

        .line {
          fill: none;
          stroke: #000;
          stroke-width: 1.5px;
        }
      </style>

      <script>
        var margin = {top: 20, right: 20, bottom: 30, left: 50},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var x = d3.time.scale()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height, 0]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left");

        var line = d3.svg.area()
            .interpolate("basis")
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d["n_homens"]); });

        var area = d3.svg.area()
            .interpolate("basis")
            .x(function(d) { return x(d.date); })
            .y1(function(d) { return y(d["n_homens"]); });

        var svg = d3.select("#diff-chart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        d3.json("data/diff_char.json", function(error, data) {
          if (error) throw error;

          var today = new Date();
          today.setHours(0, 0, 0, 0);
          var todayMillis = today.getTime();

          data.forEach(function(d) {
            var parts = d.date.split(":");
            var timePeriodMillis = (parseInt(parts[0], 10) * 60 * 60 * 1000) +
              (parseInt(parts[1], 10) * 60 * 1000);

            d.date = new Date();
            d.date.setTime(todayMillis + timePeriodMillis);

            d["n_homens"]= +d["n_homens"];
            d["n_mulheres"] = +d["n_mulheres"];
          });

          x.domain(d3.extent(data, function(d) { return d.date; }));

          y.domain([
            d3.min(data, function(d) { return Math.min(d["n_homens"], d["n_mulheres"]); }),
            d3.max(data, function(d) { return Math.max(d["n_homens"], d["n_mulheres"]); })
          ]);

          svg.datum(data);

          svg.append("clipPath")
              .attr("id", "clip-below")
            .append("path")
              .attr("d", area.y0(height));

          svg.append("clipPath")
              .attr("id", "clip-above")
            .append("path")
              .attr("d", area.y0(0));

          svg.append("path")
              .attr("class", "area above")
              .attr("clip-path", "url(#clip-above)")
              .attr("d", area.y0(function(d) { return y(d["n_mulheres"]); }));

          svg.append("path")
              .attr("class", "area below")
              .attr("clip-path", "url(#clip-below)")
              .attr("d", area);

          svg.append("path")
              .attr("class", "line")
              .attr("d", line);

          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis);

          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis)
            .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .text("Quantidade de pessoas (Pedestres e ciclistas)");
        });
      </script>

      <style>
        .chart-container .area {
          fill-opacity: 0.7;
        }
        .chart-container.focus .area {
          fill-opacity: 0.3;
        }
        .chart-container.focus .area.focused {
          fill-opacity: 0.9;
        }
        .chart-container.area.burrinhos, .burrinhos .circle {
          fill: #FFD700;
          stroke: none;
        }
        .chart-container.area.jackson, .jackson .circle {
          fill: #ADD8E6;
          stroke: none;
        }
      </style>

      <script>

        d3.json('data/radar_data.json', function(dados){
          RadarChart.draw(".chart-container", dados);
        });

      </script>

    </div>

  </body>

</html>
